# TR-09-2 Booking Tags

- **Name:**  urn:x-vsf:tag:tr-09-2:booking-list/v1.0
  - **Description:** Booking List tag that can be used to indicate that an NMOS resource is part of one or more TR-09-2 bookings.
  - **Proponent:** [VSF](https://www.vsf.tv/)

- **Name:**  urn:x-vsf:tag:tr-09-2:current-booking/v1.0
  - **Description:** Current Booking tag that can be used to indicate the current active TR-09-2 booking.
  - **Proponent:** [VSF](https://www.vsf.tv/)

This document describes an application of the AMWA IS-04 `tags` structures to enable control systems to identify NMOS resources that are being shared across a facility boundary as described in the VSF TR-09-2 specification.

## Introduction

The aim of the TR-09-2 booking tags is to facilitate the sharing of NMOS resources between two independent media facilities.

The tags contain information that allows an NMOS resource to be identified and matched to information defined during an earlier booking process.

This booking process takes place between the facility offering the shared resource and the facility consuming the shared resource, as defined in the VSF TR-09-2 specification document.

Two TR-09-2 tags are defined: the `booking-list` tag and the `current-booking` tag.

When an NMOS resource is to be shared with another facility, the facility offering the shared resource MUST include these tags in the JSON of the NMOS resource at the point it is made available at the facility edge.

## Booking List URN

The booking list URN `urn:x-vsf:tag:tr-09-2:booking-list/v1.0` defines a list of bookings associated with the shared NMOS resource. It is defined by an array containing a list of one or more bookings.

```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "{consumer-id}:{booking-id}:{resource-id}[:{label}]"
   ]
}
```

Where

| Parameter | Description | Values |
| --------- | ----------- | ------ |
| `consumer-id` | A string that defines a unique identifier for a receiving facility | ^[-_a-zA-Z0-9]+$ (case insensitive alphanumeric, hyphen and underscore) |
| `booking-id` | A string that defines a unique identifier for a booking | ^[-_a-zA-Z0-9]+$ (case insensitive alphanumeric, hyphen and underscore) |
| `resource-id` | A string that defines a unique identifier for the resource within the booking | ^[-_a-zA-Z0-9]+$ (case insensitive alphanumeric, hyphen and underscore) |
| `label` | Optional string that gives a user-friendly label for the resource within the booking | ^[-_a-zA-Z0-9 ]+$ (case insensitive alphanumeric, hyphen, underscore and space) |

The colon character, `:`, is reserved and MUST not be used in any of the parameters listed.

As defined in the VSF TR-09-2 specification:
 - The `consumer-id` SHOULD be provided by the facility *offering* the shared resource.
 - The `booking-id`, `resource-id` and `label` SHOULD be provided by the facility *consuming* the shared resource.
 - The `resource-id` MUST be unique to the TR-09-2 booking tags and MUST NOT be the same as the NMOS UUID associated with the resource (from the resource's `id` field).
 - The same `resource-id` MAY be used for a given resource across multiple bookings.

Additionally: 
 - Where a shared resource has other associated shared resources on which it is dependent these MUST use the same `resource-id` (e.g. the Source and Flow associated with a Sender MUST both be given the same `resource-id` as the Sender).
 
## Current Booking URN

The current booking URN `urn:x-vsf:tag:tr-09-2:current-booking/v1.0` defines the currently active booking for the shared NMOS resource.

If one of the bookings described in the booking list is active then the list MUST contain a single element identifying the active booking. Otherwise, the list MUST be empty.

```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "{consumer-id}:{booking-id}"
   ]
}
```

Where

| Parameter | Description | Values |
| --------- | ----------- | ------ |
| `consumer-id` | The `consumer-id` parameter associated with the currently active booking | ^[-_a-zA-Z0-9]+$ (Case insensitive alphanumeric, hyphen and underscore) |
| `booking-id` | The `booking-id` parameter associated with the currently active booking | ^[-_a-zA-Z0-9]+$ (Case insensitive alphanumeric, hyphen and underscore) |

The `consumer-id` and `booking-id` MUST originate from the same element in the booking list.

## Examples

### 1. NMOS Sender, Source and Flow resources representing a camera with one booking which is currently active
JSON tags for Sender resource
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:a04e9401-f86d-4c97-a2c4-69c78594f723:Main Camera]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0001"
   ]
}
```

JSON tags for Source resource (note that this shares the same `resource-id` as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:a04e9401-f86d-4c97-a2c4-69c78594f723:Main Camera]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0001"
   ]
}
```

JSON tags for Flow resource (note that this shares the same `resource-id` as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:a04e9401-f86d-4c97-a2c4-69c78594f723:Main Camera]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0001"
   ]
}
```

### 2. NMOS Sender, Source and Flow resources representing a camera with multiple associated bookings, the second of which is currently active
JSON tags for Sender resource
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
      "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0002"
   ]
}
```

JSON tags for Source resource (note that this shares the same `resource-id`s as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
      "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0002"
   ]
}
```

JSON tags for Flow resource (note that this shares the same `resource-id`s as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
      "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0002"
   ]
}
```

### 3. NMOS Sender, Source and Flow resources representing a camera with multiple associated bookings where the resource-id and label are the same across all bookings and the second booking is currently active
JSON tags for Sender resource
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0003:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0002"
   ]
}
```

JSON tags for Source resource (note that this shares the same `resource-id`s as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0003:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0002"
   ]
}
```

JSON tags for Flow resource (note that this shares the same `resource-id`s as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0003:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
      "ConsumerA:Booking0002"
   ]
}
```

### 4. NMOS Sender, Source and Flow resources representing a camera with multiple associated bookings, none of which is currently active
JSON tags for Sender resource
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
      "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
   ]
}
```
JSON tags for Source resource (note that this shares the same `resource-id`s as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
      "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
   ]
}
```

JSON tags for Flow resource (note that this shares the same `resource-id`s as the Sender resource)
```json
"tags": {
   "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
      "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
      "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
      "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
   ],
   "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
   ]
}
```

## NMOS resource JSON samples

Sender with tags from example 2 above

```json
{
   "format": "urn:x-nmos:format:video",
   "caps": {},
   "device_id": "8570e409-eb39-4c28-b083-fb2be5d44abe",
   "transport": "urn:x-nmos:transport:rtp.ucast",
   "interface_bindings": [],
   "subscription": {
      "sender_id": null,
      "active": true
   },
   "id": "51e6b7ef-7061-4121-b8d3-426527d3ac4f",
   "version": "1525121173:668000000",
   "label": "H200-11B Camera",
   "description": "High definition broadcast camera",
   "tags": {
      "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
         "ConsumerA:Booking0001:54aab493-1765-4cea-a095-c87a81634daa:Main Camera]",
         "ConsumerA:Booking0002:2e3b3b5c-827a-11ec-a8a3-0242ac120002:Studio Camera]",
         "ConsumerA:Booking0003:8a63bf02-3d6e-47cd-a963-c17f43da7d47:Camera 2]"
      ],
      "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
         "ConsumerA:Booking0002"
      ]
   }
}
```

A second Sender that is part of the same active booking but has no other bookings

```json
{
   "format": "urn:x-nmos:format:video",
   "caps": {},
   "device_id": "8570e409-eb39-4c28-b083-fb2be5d44abe",
   "transport": "urn:x-nmos:transport:rtp.ucast",
   "interface_bindings": [],
   "subscription": {
      "sender_id": null,
      "active": true
   },
   "id": "1b990a6b-5cf4-4639-8e50-c6055182b149",
   "version": "1525121173:668000000",
   "label": "H200-11B Camera",
   "description": "High definition broadcast camera",
   "tags": {
      "urn:x-vsf:tag:tr-09-2:booking-list/v1.0": [
         "ConsumerA:Booking0002:665e136d-65b4-4ce5-a1a0-99270857c993:Reserve Camera]"
      ],
      "urn:x-vsf:tag:tr-09-2:current-booking/v1.0": [
         "ConsumerA:Booking0002"
      ]
   }
}
```
